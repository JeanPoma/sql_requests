-- ============================================
-- EXERCICE: Correction d'erreurs SQL courantes
-- NIVEAU: üî¥ Avanc√©
-- CONCEPTS: Debugging, jointures correctes, GROUP BY complet
--
-- üéØ OBJECTIF P√âDAGOGIQUE:
-- Identifier et corriger des erreurs SQL typiques:
-- - Mauvaises jointures (cl√©s √©trang√®res incorrectes)
-- - GROUP BY incomplet (colonnes manquantes)
-- - Agr√©gats mal utilis√©s
--
-- ============================================
-- CONSIGNE:
-- Un analyste a √©crit une requ√™te avec des erreurs:
-- - Jointure incorrecte (genres mal reli√©s)
-- - GROUP BY incomplet
--
-- R√©√©crivez la requ√™te CORRECTE:
--
-- But: Par genre, calculer le nombre de jeux et le metacritic moyen,
-- uniquement pour les jeux avec year NOT NULL.
--
-- Colonnes attendues: genre, n_games, meta_avg
-- Ordre: n_games DESC
-- Limit: 20
--
-- üí° ERREURS COURANTES √Ä √âVITER:
-- ‚ùå FROM games JOIN genres ON games.id = genres.id  (FAUX!)
--    Les tables games et genres ne sont pas directement li√©es
--
-- ‚úÖ FROM games
--    JOIN game_genres ON games.id = game_genres.game_id
--    JOIN genres ON game_genres.genre_id = genres.id  (CORRECT!)
--
-- ‚ùå GROUP BY genre  (si genre n'est pas dans la table agr√©g√©e)
-- ‚úÖ GROUP BY genres.name  (ou genres.id)
--
-- ‚ùå SELECT genre, metacritic  (sans agr√©gat ni GROUP BY)
-- ‚úÖ SELECT genre, AVG(metacritic)  (avec agr√©gat)
--
-- üí° STRUCTURE CORRECTE:
-- SELECT gr.name AS genre,
--        COUNT(*) AS n_games,
--        ROUND(AVG(g.metacritic), 2) AS meta_avg
-- FROM games g
-- JOIN game_genres gg ON g.id = gg.game_id
-- JOIN genres gr ON gg.genre_id = gr.id
-- WHERE g.year IS NOT NULL
-- GROUP BY gr.name
-- ORDER BY n_games DESC
-- LIMIT 20;
-- ============================================
