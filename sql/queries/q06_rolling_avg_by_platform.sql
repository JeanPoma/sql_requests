-- ============================================
-- EXERCICE: Moyenne mobile sur 3 ans par plateforme
-- NIVEAU: üü° Interm√©diaire (avanc√©)
-- CONCEPTS: Window Functions, moyennes mobiles, ROWS/RANGE
--
-- üìö Ressources SQLZoo recommand√©es :
-- - Tutorial 8+ : https://sqlzoo.net/wiki/Window_functions
-- - Tutorial 9 : https://sqlzoo.net/wiki/Window_LAG
--
-- üéØ OBJECTIF P√âDAGOGIQUE:
-- Apprendre √† calculer des moyennes mobiles (rolling averages) avec
-- les window functions et comprendre les window frames (ROWS vs RANGE).
--
-- üí° RAPPEL DE SYNTAXE:
-- SELECT colonnes,
--        AVG(colonne) OVER (
--          PARTITION BY groupe
--          ORDER BY annee
--          ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
--        ) AS moyenne_mobile
-- FROM table;
--
-- WINDOW FRAME expliqu√©:
-- - ROWS: compte les lignes physiques
-- - RANGE: utilise les valeurs logiques
-- - BETWEEN 2 PRECEDING AND CURRENT ROW: 3 lignes (2 avant + actuelle)
--
-- ============================================
-- CONSIGNE:
-- Par plateforme et ann√©e, calculez la moyenne mobile du Metacritic
-- sur 3 ann√©es (ann√©e courante et 2 pr√©c√©dentes).
--
-- Colonnes attendues: platform, year, meta_avg_roll
--
-- Strat√©gie:
-- 1. Cr√©er une sous-requ√™te/CTE qui agr√®ge par (platform, year)
--    pour obtenir une ligne par plateforme/ann√©e
-- 2. Appliquer la window function sur ces donn√©es agr√©g√©es
--
-- Window function:
-- - Partitionn√©e par platform (chaque plateforme ind√©pendamment)
-- - Ordonn√©e par year
-- - Frame: ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
--
-- Filtres: year IS NOT NULL, metacritic IS NOT NULL
-- Ordre final: platform ASC, year ASC
--
-- üí° EXEMPLE:
-- PS4 2018 : moyenne de (2016, 2017, 2018)
-- PS4 2019 : moyenne de (2017, 2018, 2019)
-- PS4 2020 : moyenne de (2018, 2019, 2020)
--
-- üí° ASTUCE STRUCTURE:
-- WITH yearly_avg AS (
--   SELECT platform, year, AVG(metacritic) AS meta_avg
--   FROM ... JOIN ...
--   GROUP BY platform, year
-- )
-- SELECT platform, year,
--        AVG(meta_avg) OVER (
--          PARTITION BY platform
--          ORDER BY year
--          ROWS BETWEEN 2 PRECEDING AND CURRENT ROW
--        ) AS meta_avg_roll
-- FROM yearly_avg;
-- ============================================
