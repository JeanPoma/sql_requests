-- ============================================
-- EXERCICE: ProcÃ©dure avec paramÃ¨tre IN
-- NIVEAU: ðŸ”´ AvancÃ© - ProcÃ©dures StockÃ©es
-- CONCEPTS: CREATE FUNCTION, IN parameters, RETURNS TABLE
--
-- ðŸ“š Documentation PostgreSQL :
-- - [CREATE FUNCTION](https://www.postgresql.org/docs/current/sql-createfunction.html)
-- - [Function Parameters](https://www.postgresql.org/docs/current/xfunc-sql.html)
-- - [RETURNS TABLE](https://www.postgresql.org/docs/current/sql-createfunction.html#SQL-CREATEFUNCTION-EXAMPLES)
--
-- ðŸŽ¯ OBJECTIF PÃ‰DAGOGIQUE:
-- Apprendre Ã  crÃ©er une fonction avec des paramÃ¨tres d'entrÃ©e (IN)
-- pour rendre le code rÃ©utilisable avec diffÃ©rentes valeurs.
--
-- ðŸ’¡ PARAMÃˆTRES IN:
-- Les paramÃ¨tres IN permettent de passer des valeurs Ã  la fonction.
-- Syntaxe: nom_param TYPE (IN est implicite)
--
-- Exemple: min_score INT
--
-- âš ï¸ PROCEDURE vs FUNCTION en PostgreSQL:
-- - PROCEDURE : Pour opÃ©rations sans rÃ©sultat (INSERT, UPDATE, DELETE)
-- - FUNCTION : Pour opÃ©rations avec rÃ©sultat (SELECT)
--
-- Pour retourner un rÃ©sultat SELECT, on utilise FUNCTION RETURNS TABLE.
--
-- ============================================
-- CONSIGNE:
-- CrÃ©ez une fonction 'sp_get_games_by_score' qui recherche des jeux
-- selon un score minimum fourni en paramÃ¨tre.
--
-- Nom: sp_get_games_by_score
-- ParamÃ¨tres:
-- - min_score INT : score minimum Metacritic
--
-- Action:
-- Retourner les 20 meilleurs jeux avec metacritic >= min_score
--
-- Colonnes Ã  retourner: name, year, metacritic
-- Ordre: metacritic DESC
-- Limite: 20
--
-- ðŸ’¡ SYNTAXE POSTGRESQL:
-- CREATE OR REPLACE FUNCTION sp_get_games_by_score(min_score INT)
-- RETURNS TABLE(name VARCHAR, year SMALLINT, metacritic SMALLINT)
-- LANGUAGE plpgsql
-- AS $$
-- BEGIN
--     RETURN QUERY
--     SELECT g.name, g.year, g.metacritic
--     FROM games g
--     WHERE g.metacritic >= min_score
--     ORDER BY g.metacritic DESC
--     LIMIT 20;
-- END;
-- $$;
--
-- ðŸ’¡ UTILISATION:
-- SELECT * FROM sp_get_games_by_score(90);  -- Jeux avec score >= 90
-- SELECT * FROM sp_get_games_by_score(80);  -- Jeux avec score >= 80
--
-- âš ï¸ DIFFÃ‰RENCES POSTGRESQL vs MariaDB:
-- 1. CREATE FUNCTION au lieu de CREATE PROCEDURE (pour retourner rÃ©sultats)
-- 2. RETURNS TABLE(...) pour dÃ©finir les colonnes retournÃ©es
-- 3. RETURN QUERY avant le SELECT
-- 4. Appel avec SELECT FROM au lieu de CALL
-- 5. $$ au lieu de DELIMITER //
--
-- ðŸ’¡ POURQUOI C'EST UTILE ?
-- Au lieu de rÃ©Ã©crire la requÃªte Ã  chaque fois, on appelle
-- simplement la fonction avec le paramÃ¨tre souhaitÃ©.
--
-- ðŸ’¡ ALTERNATIVE avec PROCEDURE + REFCURSOR (plus complexe):
-- CREATE OR REPLACE PROCEDURE sp_get_games_by_score(
--     min_score INT,
--     INOUT result REFCURSOR
-- )
-- LANGUAGE plpgsql
-- AS $$
-- BEGIN
--     OPEN result FOR
--     SELECT name, year, metacritic
--     FROM games
--     WHERE metacritic >= min_score
--     ORDER BY metacritic DESC
--     LIMIT 20;
-- END;
-- $$;
-- -- Appel: CALL sp_get_games_by_score(90, 'cur'); FETCH ALL FROM cur;
-- ============================================

