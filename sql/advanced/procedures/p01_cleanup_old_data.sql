-- ============================================
-- EXERCICE: Proc√©dure simple (sans param√®tres)
-- NIVEAU: üî¥ Avanc√© - Proc√©dures Stock√©es
-- CONCEPTS: CREATE PROCEDURE, UPDATE, GET DIAGNOSTICS
--
-- üìö Documentation PostgreSQL :
-- - [CREATE PROCEDURE](https://www.postgresql.org/docs/current/sql-createprocedure.html)
-- - [PL/pgSQL Procedures](https://www.postgresql.org/docs/current/plpgsql-structure.html)
-- - [GET DIAGNOSTICS](https://www.postgresql.org/docs/current/plpgsql-statements.html#PLPGSQL-STATEMENTS-DIAGNOSTICS)
--
-- üéØ OBJECTIF P√âDAGOGIQUE:
-- Cr√©er une proc√©dure stock√©e basique qui effectue une op√©ration
-- et retourne le nombre de lignes affect√©es.
--
-- üí° QU'EST-CE QU'UNE PROC√âDURE STOCK√âE ?
-- Une proc√©dure est un ensemble d'instructions SQL sauvegard√©es
-- dans la base de donn√©es, qu'on peut appeler avec CALL.
--
-- Avantages:
-- - R√©utilisabilit√© du code
-- - Performance (compil√©e)
-- - Logique m√©tier centralis√©e
-- - S√©curit√© (permissions granulaires)
--
-- ============================================
-- CONSIGNE:
-- Cr√©ez une proc√©dure 'sp_cleanup_old_data' qui marque les jeux
-- trop anciens sans beaucoup de notes comme "non not√©s".
--
-- Nom: sp_cleanup_old_data
-- Param√®tres: AUCUN
--
-- Action:
-- Mettre metacritic √† NULL pour les jeux qui r√©pondent √†:
-- - year < 1990
-- - ratings_count < 10
--
-- Retour:
-- RAISE NOTICE pour afficher le nombre de lignes modifi√©es
-- (PostgreSQL n'a pas de SELECT direct dans les proc√©dures,
--  on utilise RAISE NOTICE ou un param√®tre OUT)
--
-- üí° SYNTAXE POSTGRESQL (PL/pgSQL):
-- CREATE OR REPLACE PROCEDURE nom_procedure()
-- LANGUAGE plpgsql
-- AS $$
-- DECLARE
--     rows_affected INT;
-- BEGIN
--     -- Instructions SQL
--     UPDATE ...
--
--     -- R√©cup√©rer le nombre de lignes modifi√©es
--     GET DIAGNOSTICS rows_affected = ROW_COUNT;
--
--     -- Afficher le r√©sultat
--     RAISE NOTICE 'Rows affected: %', rows_affected;
-- END;
-- $$;
--
-- üí° UTILISATION:
-- CALL sp_cleanup_old_data();
--
-- ‚ö†Ô∏è DIFF√âRENCES POSTGRESQL vs MariaDB:
-- 1. Pas de DELIMITER // (utilise $$ √† la place)
-- 2. LANGUAGE plpgsql obligatoire
-- 3. GET DIAGNOSTICS au lieu de ROW_COUNT()
-- 4. DECLARE avant BEGIN
-- 5. RAISE NOTICE au lieu de SELECT pour afficher
--
-- üí° ALTERNATIVE avec OUT parameter:
-- CREATE OR REPLACE PROCEDURE sp_cleanup_old_data(OUT rows_affected INT)
-- LANGUAGE plpgsql
-- AS $$
-- BEGIN
--     UPDATE games
--     SET metacritic = NULL
--     WHERE year < 1990 AND ratings_count < 10;
--
--     GET DIAGNOSTICS rows_affected = ROW_COUNT;
-- END;
-- $$;
-- ============================================

