-- ============================================
-- EXERCICE: ProcÃ©dure avec logique conditionnelle
-- NIVEAU: ðŸ”´ AvancÃ© - ProcÃ©dures StockÃ©es
-- CONCEPTS: IF/ELSIF/ELSE, DECLARE, variables locales
--
-- ðŸ“š Documentation PostgreSQL :
-- - [IF Statement](https://www.postgresql.org/docs/current/plpgsql-control-structures.html#PLPGSQL-CONDITIONALS)
-- - [DECLARE Variables](https://www.postgresql.org/docs/current/plpgsql-declarations.html)
--
-- ðŸŽ¯ OBJECTIF PÃ‰DAGOGIQUE:
-- Utiliser des structures conditionnelles (IF/ELSIF/ELSE)
-- et des variables locales dans une procÃ©dure.
--
-- ðŸ’¡ VARIABLES LOCALES:
-- DECLARE nom_variable TYPE;
-- nom_variable := valeur;
-- SELECT colonne INTO nom_variable FROM ...;
--
-- ðŸ’¡ STRUCTURE IF:
-- IF condition THEN
--     instructions
-- ELSIF condition THEN
--     instructions
-- ELSE
--     instructions
-- END IF;
--
-- âš ï¸ ATTENTION: ELSIF (pas ELSEIF comme en MariaDB)
--
-- ============================================
-- CONSIGNE:
-- CrÃ©ez une procÃ©dure 'sp_classify_game' qui classifie un jeu
-- selon son score Metacritic.
--
-- Nom: sp_classify_game
-- ParamÃ¨tres:
-- - IN game_id INT : ID du jeu Ã  classifier
-- - INOUT classification VARCHAR(50) : classification du jeu
--
-- Classifications:
-- - NULL â†’ 'Non notÃ©'
-- - >= 90 â†’ 'Chef-d\'Å“uvre'
-- - >= 80 â†’ 'Excellent'
-- - >= 70 â†’ 'Bon'
-- - >= 60 â†’ 'Moyen'
-- - < 60 â†’ 'Faible'
--
-- ðŸ’¡ SYNTAXE POSTGRESQL:
-- CREATE OR REPLACE PROCEDURE sp_classify_game(
--     IN game_id INT,
--     INOUT classification VARCHAR(50) DEFAULT NULL
-- )
-- LANGUAGE plpgsql
-- AS $$
-- DECLARE
--     score INT;
-- BEGIN
--     -- RÃ©cupÃ©rer le score
--     SELECT metacritic INTO score
--     FROM games
--     WHERE id = game_id;
--
--     -- Classifier
--     IF score IS NULL THEN
--         classification := 'Non notÃ©';
--     ELSIF score >= 90 THEN
--         classification := 'Chef-d''Å“uvre';
--     ELSIF score >= 80 THEN
--         classification := 'Excellent';
--     ELSIF score >= 70 THEN
--         classification := 'Bon';
--     ELSIF score >= 60 THEN
--         classification := 'Moyen';
--     ELSE
--         classification := 'Faible';
--     END IF;
-- END;
-- $$;
--
-- ðŸ’¡ UTILISATION:
-- CALL sp_classify_game(123, NULL);
--
-- âš ï¸ DIFFÃ‰RENCES POSTGRESQL vs MariaDB:
-- 1. ELSIF au lieu de ELSEIF (attention Ã  l'orthographe !)
-- 2. := pour l'affectation au lieu de SET
-- 3. DECLARE avant BEGIN (ordre strict)
-- 4. '' pour Ã©chapper les quotes (Chef-d''Å“uvre)
-- 5. INOUT au lieu de OUT pour les procÃ©dures
--
-- ðŸ’¡ ALTERNATIVE avec CASE:
-- CREATE OR REPLACE PROCEDURE sp_classify_game(
--     IN game_id INT,
--     INOUT classification VARCHAR(50) DEFAULT NULL
-- )
-- LANGUAGE plpgsql
-- AS $$
-- DECLARE
--     score INT;
-- BEGIN
--     SELECT metacritic INTO score FROM games WHERE id = game_id;
--
--     classification := CASE
--         WHEN score IS NULL THEN 'Non notÃ©'
--         WHEN score >= 90 THEN 'Chef-d''Å“uvre'
--         WHEN score >= 80 THEN 'Excellent'
--         WHEN score >= 70 THEN 'Bon'
--         WHEN score >= 60 THEN 'Moyen'
--         ELSE 'Faible'
--     END;
-- END;
-- $$;
-- ============================================

