-- ============================================
-- EXERCICE: Trigger BEFORE INSERT (validation)
-- NIVEAU: ðŸ”´ AvancÃ© - Triggers
-- CONCEPTS: BEFORE INSERT, validation, SIGNAL
--
-- ðŸ“š Documentation MariaDB :
-- - [CREATE TRIGGER](https://mariadb.com/kb/en/create-trigger/)
-- - [Trigger Overview](https://mariadb.com/kb/en/triggers/)
-- - [SIGNAL](https://mariadb.com/kb/en/signal/)
--
-- ðŸŽ¯ OBJECTIF PÃ‰DAGOGIQUE:
-- CrÃ©er un trigger qui valide les donnÃ©es AVANT insertion
-- et empÃªche l'insertion si les donnÃ©es sont invalides.
--
-- ðŸ’¡ QU'EST-CE QU'UN TRIGGER ?
-- Un trigger est une procÃ©dure qui s'exÃ©cute automatiquement
-- en rÃ©ponse Ã  un Ã©vÃ©nement (INSERT, UPDATE, DELETE).
--
-- Types de triggers:
-- - BEFORE : s'exÃ©cute AVANT l'opÃ©ration (peut modifier/rejeter)
-- - AFTER : s'exÃ©cute APRÃˆS l'opÃ©ration (pour audit, notifications)
--
-- ============================================
-- CONSIGNE:
-- CrÃ©ez un trigger 'trg_validate_game_insert' qui valide les donnÃ©es
-- avant l'insertion d'un nouveau jeu dans la table 'games'.
--
-- Nom: trg_validate_game_insert
-- Table: games
-- Moment: BEFORE INSERT
--
-- Validations:
-- 1. Le nom du jeu (NEW.name) ne doit pas Ãªtre vide
--    â†’ Si vide, SIGNAL avec message 'Game name cannot be empty'
--
-- 2. L'annÃ©e (NEW.year) doit Ãªtre entre 1970 et l'annÃ©e courante
--    â†’ Si invalide, SIGNAL avec message 'Invalid game year'
--
-- 3. Si metacritic est fourni, il doit Ãªtre entre 0 et 100
--    â†’ Si invalide, SIGNAL avec message 'Metacritic score must be between 0 and 100'
--
-- ðŸ’¡ SYNTAXE:
-- DELIMITER //
-- CREATE TRIGGER trg_validate_game_insert
-- BEFORE INSERT ON games
-- FOR EACH ROW
-- BEGIN
--     -- NEW.colonne contient la nouvelle valeur Ã  insÃ©rer
--
--     IF NEW.name IS NULL OR NEW.name = '' THEN
--         SIGNAL SQLSTATE '45000'
--         SET MESSAGE_TEXT = 'Game name cannot be empty';
--     END IF;
--
--     IF NEW.year < 1970 OR NEW.year > YEAR(CURDATE()) THEN
--         SIGNAL SQLSTATE '45000'
--         SET MESSAGE_TEXT = 'Invalid game year';
--     END IF;
--
--     IF NEW.metacritic IS NOT NULL AND (NEW.metacritic < 0 OR NEW.metacritic > 100) THEN
--         SIGNAL SQLSTATE '45000'
--         SET MESSAGE_TEXT = 'Metacritic score must be between 0 and 100';
--     END IF;
-- END //
-- DELIMITER ;
--
-- ðŸ’¡ UTILISATION:
-- -- Cette insertion devrait rÃ©ussir
-- INSERT INTO games (name, year, metacritic) VALUES ('Valid Game', 2023, 85);
--
-- -- Cette insertion devrait Ã©chouer (nom vide)
-- INSERT INTO games (name, year, metacritic) VALUES ('', 2023, 85);
--
-- -- Cette insertion devrait Ã©chouer (annÃ©e invalide)
-- INSERT INTO games (name, year, metacritic) VALUES ('Old Game', 1800, 85);
--
-- ðŸ’¡ SIGNAL:
-- SIGNAL permet de gÃ©nÃ©rer une erreur personnalisÃ©e.
-- SQLSTATE '45000' est le code pour les erreurs dÃ©finies par l'utilisateur.
--
-- ðŸ’¡ NEW vs OLD:
-- - NEW : contient les nouvelles valeurs (INSERT, UPDATE)
-- - OLD : contient les anciennes valeurs (UPDATE, DELETE)
-- ============================================

