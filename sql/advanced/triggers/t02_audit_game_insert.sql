-- ============================================
-- EXERCICE: Trigger AFTER INSERT (audit log)
-- NIVEAU: üî¥ Avanc√© - Triggers
-- CONCEPTS: AFTER INSERT, audit trail, logging
--
-- üìö Documentation MariaDB :
-- - [CREATE TRIGGER](https://mariadb.com/kb/en/create-trigger/)
-- - [NOW()](https://mariadb.com/kb/en/now/)
--
-- üéØ OBJECTIF P√âDAGOGIQUE:
-- Cr√©er un trigger qui enregistre automatiquement toutes les
-- insertions dans une table d'audit pour tra√ßabilit√©.
--
-- üí° AUDIT TRAIL:
-- Un audit trail (journal d'audit) enregistre toutes les modifications
-- dans la base de donn√©es : qui, quoi, quand.
--
-- Utilis√© pour:
-- - Tra√ßabilit√© (conformit√© RGPD, SOX, etc.)
-- - D√©bogage (quand une donn√©e a √©t√© ajout√©e ?)
-- - S√©curit√© (d√©tecter des modifications suspectes)
--
-- ============================================
-- CONSIGNE:
-- Cr√©ez d'abord une table d'audit 'games_audit', puis un trigger
-- 'trg_audit_game_insert' qui enregistre chaque insertion.
--
-- √âtape 1: Cr√©er la table games_audit
-- CREATE TABLE IF NOT EXISTS games_audit (
--     audit_id INT AUTO_INCREMENT PRIMARY KEY,
--     game_id INT,
--     game_name VARCHAR(255),
--     operation VARCHAR(10),
--     operation_time DATETIME,
--     INDEX idx_audit_time (operation_time)
-- );
--
-- √âtape 2: Cr√©er le trigger
-- Nom: trg_audit_game_insert
-- Table: games
-- Moment: AFTER INSERT
--
-- Action:
-- Ins√©rer une ligne dans games_audit avec:
-- - game_id: NEW.id
-- - game_name: NEW.name
-- - operation: 'INSERT'
-- - operation_time: NOW()
--
-- üí° SYNTAXE:
-- DELIMITER //
-- CREATE TRIGGER trg_audit_game_insert
-- AFTER INSERT ON games
-- FOR EACH ROW
-- BEGIN
--     INSERT INTO games_audit (game_id, game_name, operation, operation_time)
--     VALUES (NEW.id, NEW.name, 'INSERT', NOW());
-- END //
-- DELIMITER ;
--
-- üí° UTILISATION:
-- -- Ins√©rer un jeu
-- INSERT INTO games (name, year) VALUES ('Audited Game', 2023);
--
-- -- V√©rifier l'audit
-- SELECT * FROM games_audit WHERE operation = 'INSERT' ORDER BY operation_time DESC;
--
-- üí° POURQUOI AFTER et pas BEFORE ?
-- AFTER INSERT garantit que:
-- - L'insertion a r√©ussi
-- - Les valeurs AUTO_INCREMENT (comme NEW.id) sont disponibles
-- - Les contraintes d'int√©grit√© sont v√©rifi√©es
--
-- üí° CAS D'USAGE R√âELS:
-- - Conformit√© r√©glementaire (banque, sant√©)
-- - Tra√ßabilit√© des modifications sensibles
-- - Statistiques d'utilisation
-- ============================================

