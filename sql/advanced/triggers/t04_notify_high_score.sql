-- ============================================
-- EXERCICE: Trigger AFTER UPDATE (notifications)
-- NIVEAU: ðŸ”´ AvancÃ© - Triggers
-- CONCEPTS: AFTER UPDATE, conditional logic, notifications
--
-- ðŸ“š Documentation MariaDB :
-- - [CREATE TRIGGER](https://mariadb.com/kb/en/create-trigger/)
-- - [IF Statement](https://mariadb.com/kb/en/if/)
--
-- ðŸŽ¯ OBJECTIF PÃ‰DAGOGIQUE:
-- CrÃ©er un trigger qui dÃ©tecte des Ã©vÃ©nements spÃ©cifiques
-- (ici: un jeu qui atteint un score exceptionnel) et enregistre
-- une notification.
--
-- ðŸ’¡ TRIGGERS POUR NOTIFICATIONS:
-- Les triggers peuvent dÃ©tecter des conditions mÃ©tier importantes
-- et dÃ©clencher des actions:
-- - Enregistrer dans une table de notifications
-- - IncrÃ©menter des compteurs
-- - Mettre Ã  jour des statistiques
--
-- ============================================
-- CONSIGNE:
-- CrÃ©ez une table 'notifications' puis un trigger qui dÃ©tecte
-- quand un jeu atteint un score Metacritic >= 95.
--
-- Ã‰tape 1: CrÃ©er la table notifications
-- CREATE TABLE IF NOT EXISTS notifications (
--     notif_id INT AUTO_INCREMENT PRIMARY KEY,
--     game_id INT,
--     game_name VARCHAR(255),
--     message TEXT,
--     created_at DATETIME,
--     INDEX idx_notif_time (created_at)
-- );
--
-- Ã‰tape 2: CrÃ©er le trigger
-- Nom: trg_notify_high_score
-- Table: games
-- Moment: AFTER UPDATE
--
-- Action:
-- Si NEW.metacritic >= 95 ET (OLD.metacritic < 95 OU OLD.metacritic IS NULL),
-- alors insÃ©rer dans notifications:
-- - game_id: NEW.id
-- - game_name: NEW.name
-- - message: 'High score achieved: [score]'
-- - created_at: NOW()
--
-- ðŸ’¡ SYNTAXE:
-- DELIMITER //
-- CREATE TRIGGER trg_notify_high_score
-- AFTER UPDATE ON games
-- FOR EACH ROW
-- BEGIN
--     -- DÃ©tecter si le jeu vient d'atteindre un score >= 95
--     IF NEW.metacritic >= 95 AND
--        (OLD.metacritic IS NULL OR OLD.metacritic < 95)
--     THEN
--         INSERT INTO notifications (game_id, game_name, message, created_at)
--         VALUES (
--             NEW.id,
--             NEW.name,
--             CONCAT('High score achieved: ', NEW.metacritic),
--             NOW()
--         );
--     END IF;
-- END //
-- DELIMITER ;
--
-- ðŸ’¡ UTILISATION:
-- -- Mettre Ã  jour un jeu pour atteindre 95+
-- UPDATE games SET metacritic = 96 WHERE id = 123 AND (metacritic < 95 OR metacritic IS NULL);
--
-- -- VÃ©rifier les notifications
-- SELECT * FROM notifications ORDER BY created_at DESC;
--
-- ðŸ’¡ POURQUOI AFTER UPDATE ?
-- AFTER UPDATE garantit que:
-- - La modification a bien Ã©tÃ© appliquÃ©e
-- - Les contraintes sont validÃ©es
-- - On peut utiliser NEW.id en toute sÃ©curitÃ©
--
-- ðŸ’¡ CONCAT:
-- CONCAT() permet de concatÃ©ner des chaÃ®nes de caractÃ¨res.
-- Exemple: CONCAT('Score: ', NEW.metacritic) â†’ 'Score: 96'
--
-- ðŸ’¡ CAS D'USAGE RÃ‰ELS:
-- - Alertes mÃ©tier (stock faible, seuil atteint)
-- - Gamification (badges, achievements)
-- - Monitoring (dÃ©tecter des anomalies)
-- ============================================

